# Technical Specification: PolyWeather Minimal Dashboard (Vue 3 + Python)

**Version:** 0.2.0
**Scope:** Single-page, minimal, modern dashboard for Seoul (RKSI) daily high temperature market.

## 1. Goals
- Show **hourly forecast vs actual** temperature for the current local day in Seoul.
- Show **real-time market prices** for today’s Seoul highest-temperature event (auto-detect slug).
- Show **personal data**: CLOB collateral balance and open positions.
- Keep UI minimal and readable; no trading actions in v2.

## 2. Architecture
### 2.1 Frontend
- **Framework:** Vue 3 (Vite build).
- **Layout:** single page with 3 panels: Weather, Market, Portfolio.
- **Polling:** every 30s for unified dashboard payload.
- **Charts:** line chart with two series (Forecast, Actual).

### 2.2 Backend
- **Framework:** Python (FastAPI) as a thin proxy and aggregator.
- **Reasoning:** keeps API keys private, simplifies CORS, easy scheduled caching.
- **Security:** secrets stored in `.env`; never exposed to client.
- **CLOB Client:** use the official Polymarket Python CLOB client for authenticated balance.

## 3. Data Sources
### 3.1 Forecast (free, default model)
- **Provider:** Open-Meteo.
- **Endpoint:** `https://api.open-meteo.com/v1/forecast`
- **Parameters:** `latitude`, `longitude`, `hourly=temperature_2m`, `timezone=Asia/Seoul`.
- **RKSI Coordinates:** `lat=37.469`, `lon=126.451`.

### 3.2 Actuals (METAR)
- **Provider:** Aviation Weather Center.
- **Endpoint:** `https://aviationweather.gov/api/data/metar`
- **Parameters:** `ids=RKSI`, `format=json`, `hours=24`.

### 3.3 Market Data
- **Gamma API (event discovery):** `https://gamma-api.polymarket.com`
- **CLOB API (prices):** `https://clob.polymarket.com`
- **Data API (positions/activity):** `https://data-api.polymarket.com`

## 4. Event Auto-Detection
- Use **local date in Asia/Seoul** to compute slug:
  - `highest-temperature-in-seoul-on-{month}-{day}`
  - Month is lowercase full name (e.g., `january`), day is numeric (no zero padding).
- Flow:
  1) Build slug from KST date.
  2) Query Gamma event by slug (prefer `/events/slug/{slug}`; fallback to `/events?slug=...`).
  3) Extract `markets[]` and `clobTokenIds` from response.
  4) If missing, show "no event found" state and last successful slug.

## 5. Data Normalization
### 5.1 Time Axis (KST)
- All timestamps displayed in **Asia/Seoul**.
- Forecast and actual series aligned to **hourly ticks** (00:00–23:00 local).

### 5.2 Actuals (METAR) to Hourly
- METAR observations are irregular; derive hourly actuals as:
  - For each hour, use the **most recent METAR reading at or before** that hour.
  - If no reading exists for an hour, leave it null (gap in chart).

### 5.3 Day High So Far
- Compute **max actual temperature since local 00:00** and display prominently.

## 6. Backend API (internal)
- `GET /api/dashboard`
  - Returns a single payload for the frontend containing:
    - `meta`: last refresh, KST date, slug.
    - `weather`: hourly forecast + hourly actual arrays.
    - `market`: list of outcomes with last price.
    - `portfolio`: balance, positions.

### 6.1 External Requests (backend only)
- **Forecast:** Open-Meteo hourly temps.
- **Actuals:** METAR last 24h.
- **Market:** Gamma event -> CLOB prices by token id.
- **Portfolio:** CLOB balance + Data API positions.

### 6.2 Caching
- In-memory cache with **TTL 25–30s** to avoid rate limits.
- Cache keys: `forecast`, `metar`, `event`, `prices`, `portfolio`.

## 7. Portfolio Data
- **Balance:** CLOB collateral balance (USDC) via authenticated CLOB request.
- **Positions:** Data API `GET /positions?user=...`.

## 8. UI Layout (Minimal)
- **Header:**
  - Title: “Seoul Daily High (RKSI)”
  - Current KST date
  - Last refresh time
  - Day high so far
- **Weather panel:**
  - Line chart: Forecast vs Actual
  - Small legend with units (C)
- **Market panel:**
  - Table of outcomes: label, last price
- **Portfolio panel:**
  - Balance
  - Positions list (market, outcome, size, avg price)

## 9. Configuration (.env)
- `RKSI_LAT=37.469`
- `RKSI_LON=126.451`
- `SEOUL_TIMEZONE=Asia/Seoul`
- `MARKET_SLUG_PREFIX=highest-temperature-in-seoul-on`
- `POLYMARKET_USER_ADDRESS`
- `POLYMARKET_API_KEY`
- `POLYMARKET_API_SECRET`
- `POLYMARKET_API_PASSPHRASE`
- `CACHE_TTL_SECONDS=30`
- `PORT=3000`

## 10. Security
- Secrets never sent to browser.
- Backend only performs authenticated calls.
- Frontend only hits `/api/dashboard`.

## 11. Non-Goals (v2)
- No order placement or trading actions.
- No multi-city support.
- No mobile app.

## 12. Open Questions
- None.
